<odoo>
    <record id="form_view_sale_order_approval_history" model="ir.ui.view">
        <field name="name">form.view.sale.order.approval.history</field>
        <field name="model">sale.order.approval.history</field>
        <field name="arch" type="xml">
            <form string="Sale Order Approval History" create="0">
                <sheet>
                    <group>
                        <group>
                            <field name="user_id"/>
                            <field name="status"/>
                        </group>
                        <group>
                            <field name="action_date"/>
                            <field name="sale_id" invisible="1"/>
                        </group>
                    </group>
                </sheet>
            </form>
        </field>
    </record>
    <record id="sale_order_approval_history_tree_view" model="ir.ui.view">
        <field name="name">sale.order.approval.history.tree</field>
        <field name="model">sale.order.approval.history</field>
        <field name="arch" type="xml">
            <tree string="Sale Order Approval History" edit="1" delete="1">
                <field name="user_id"/>
                <field name="status"/>
                <field name="action_date"/>
                <field name="sale_id" invisible="1"/>
            </tree>
        </field>
    </record>

    <record id="sale_order_approval_history_act_window" model="ir.actions.act_window">
        <field name="name">Sale Order Approval History</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">sale.order.approval.history</field>
        <field name="view_mode">tree,form</field>
    </record>

    <record id="sale_order_form_inherit" model="ir.ui.view">
        <field name="name">sale.order.form.inherit</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_form"/>
        <field name="arch" type="xml">
            <xpath expr="//page[2]" position="before">
                <page name="approvers" string="Approvers">
                    <field name="dynamic_approve_request_ids" readonly="1"
                           attrs="{'invisible':[('dynamic_approve_request_ids','=',False)]}">
                        <tree editable="bottom">
                            <!--                            <field name="sequence"/>-->
                            <field name="approval_states"/>
                            <field name="user_id"/>
                            <!--                            <field name="group_id"/>-->
                            <field name="approve_date"/>
                            <field name="approve_note"/>
                            <field name="reject_date"/>
                            <field name="reject_reason"/>
                            <field name="status"/>
                        </tree>
                    </field>
                </page>
                <page string="Approval History" name="approval_history"
                      attrs="{'invisible':[('approval_history_ids','=',False)]}">
                    <field name="approval_history_ids">
                        <tree create="0" edit="0" delete="0">
                            <field name="user_id" options="{'no_create': True, 'no_open': True}"/>
                            <field name="status"/>
                            <field name="sale_order_status"/>
                            <field name="action_date"/>
                        </tree>
                    </field>
                </page>

            </xpath>
            <xpath expr="//button[@name='action_cancel']" position="attributes">
                <attribute name="attrs">{'invisible': ['|', ('state', 'in', ['cancel', 'done','under_approval']), ('id',
                    '=', False)]}
                </attribute>
            </xpath>
            <xpath expr="//header" position="inside">
                <!--                <field name="appear_recall_button" invisible="1"/>-->
                <field name="dynamic_approve_pending_group" invisible="1"/>
                <field name="is_dynamic_approval_requester" invisible="1"/>
                <button name="action_dynamic_approval_request" string="Request Approval" type="object"
                        class="btn-primary"
                        attrs="{'invisible': ['|',('state', 'not in', ['draft','sent']),('is_dynamic_approval_requester', '=', False)]}"/>

                <button name="%(base_dynamic_approval.approve_dynamic_approval_wizard_action)d" string="Approve"
                        type="action"
                        class="btn-primary"
                        attrs="{'invisible':['|',('dynamic_approve_pending_group','=',False),('state','=','cancel')]}"/>

                <button name="%(base_dynamic_approval.reject_dynamic_approval_wizard_action)d" string="Reject"
                        type="action"
                        attrs="{'invisible':['|',('state','!=','under_approval'),'&amp;',('dynamic_approve_pending_group','=',False),('state','=','under_approval')]}"/>

                <button name="%(base_dynamic_approval.recall_dynamic_approval_wizard_action)d" string="Recall"
                        type="action"
                        attrs="{'invisible':[('state','!=','under_approval')]}"/>
            </xpath>
            <xpath expr="//field[@name='state']" position="attributes">
                <attribute name="statusbar_visible">draft,sent,under_approval,approved,sale</attribute>
            </xpath>
            <xpath expr="//button[@name='action_confirm'][1]" position="attributes">
                <attribute name="attrs">{'invisible': ['|',('state', 'not in',
                    ['approved']),('is_dynamic_approval_requester', '=', False)]}
                </attribute>
            </xpath>
            <xpath expr="//button[@name='action_confirm'][2]" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='order_line']" position="attributes">
                <attribute name="attrs">{'readonly': [('state', 'not in', ('draft','sent'))]}</attribute>
            </xpath>
            <xpath expr="//group[@name='technical']" position="inside">
                <field name="dynamic_approval_id" widget="selection" attrs="{'readonly': [('state','=', 'revised')]}"/>
                <field name="approve_requester_id" attrs="{'readonly': [('state','=', 'revised')]}"/>
            </xpath>
        </field>
    </record>
</odoo>